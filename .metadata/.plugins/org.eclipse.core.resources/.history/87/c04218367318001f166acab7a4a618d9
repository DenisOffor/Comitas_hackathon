/*
 * AHT20.c
 *
 *  Created on: 3 ����. 2023 �.
 *      Author: denlo
 */


#include "AHT20.h"

uint8_t AHT_state = AHT_START_CONVERSATION;
uint8_t start_state = 0;

void I2C_for_AHT_init() {
	RCC->APB2ENR |= RCC_APB2ENR_IOPBEN;
	GPIOB->CRL |= GPIO_CRL_MODE6 | GPIO_CRL_MODE6 | GPIO_CRL_CNF6 | GPIO_CRL_CNF7;

	RCC->APB1ENR |= RCC_APB1ENR_I2C1EN;
	I2C1->CR1 &= ~I2C_CR1_PE;

	//I2C2 clk 40 MHz
	I2C1->CR2 |= I2C_CR2_FREQ_3; //8
	I2C1->CCR |= I2C_CCR_CCR;
	I2C1->TRISE = 0x0009;
}

void I2C_AHT_SendByte(uint8_t addr, uint8_t byte) {
	while((I2C1->SR2 & I2C_SR2_BUSY) == I2C_SR2_BUSY);
	while((I2C1->SR1 & I2C_SR1_TXE) != I2C_SR1_TXE);
}


