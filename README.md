# Comitas_hackathon
# Структура
Comitas_hackathon_CMSIS/ -  ПО для микроконтроллера, написанное на библиотеке CMSIS, так как HAL не интересен - сложности в нём ноль, интуитивно понятен, а хочется понимать работу на низком уровне.

datasheets/ - различные ПДФ с документацией

Keil_CMSIS_stm32f100RB/ - в протеусе датчики не работают, так как периферия очень часто отказывается правильно работать, поэтому в беседе хакатона мною был задан вопрос: насколько протеус адекватно симулирует МК. В ответ получил: "Подобные проблемы являются возможными при проектировании систем и то, как они будут решаться, непосредственно влияет на оценку". Моё решение - купить плату с stm32f1 серией (оперативно нашёл stm32vldisc с stm32f100RB на борту) и протестить работу датчиков (DS18B20 также нашёл, другие не нашёл, но взял AHT20, работающий по I2C чисто для теста, ведь логика в целом одна и та же и отличия в коде чисто в посылаемых байтах и количестве считываемых) и как результат - то, что не работало в протеус, работает на железе. Надеюсь, это хоть как-то будет учтено...эх....

Proteus/ - проект протеуса (ни один датчик в нём не работает по неизвестным причинам:/, об этом также в следующем пункте). Не знаю, как сохраняются настройки в протеус, но терминал если что нужно настроить на 115200 бод (стоковое значение 9600) 

PCB_Project/ - пункты 1 и 2 задания (выполнено в Altium designer). При открытии проекта выпадают ошибки, не изменяющие Schematic и PCB, так как из папки была удалена предоставленная в беседе хакатона библиотека весом 1 Гб :)

## Чудеса протеуса 
После написания кода для DS18B20 в протеусе, несмотря на полное (на мой взгляд) соответствие таймингов протоколу 1-Wire, датчик отказывался воспринимать команду преобразования температуры и отправки своего Scratchpad, но при этом реагировал на команду Read ROM (то есть тайминги работают...). После приобретения платы stm32vldisc сразу же протестировал код с датчиком (так как одна серия f1 то ничего менять в коде не пришлось). Нашёл у знакомого логический анализатор и решил посмотреть что там...Во-первых, конечно всё работало, датчик измерял и присылал температуру, но самое интересное - тайминги совпадают с кодом и протеусом...Что я только не тыкал и не делал в Proteus - чуда не произошло, а вся эта писанина, думаю, чисто для души, ведь наболело :)

![Логический анализатор](https://github.com/DenisOffor/Comitas_hackathon/blob/da8978a527759ef924cf87de4fd2afe6c3dd8457/img/DS18B20_real.jpg)
![Proteus](https://github.com/DenisOffor/Comitas_hackathon/blob/da8978a527759ef924cf87de4fd2afe6c3dd8457/img/DS18B20_proteus.jpg)

##Чудеса протеуса с I2C
Датчик AHT20 по интерфейсу I2C на железе отлично работает (ссылка на видео в конце), но в Prtoteus всё плохо..Посылается правльный адрес, датчик шлёт ACK бит, НО микроконтроллер встаёт на I2C_SR1_ADDR, который никак не хочется ставится (а должен это сделать аппаратно). Судя по различным обсуждениям любителей и опытных людей на форумах, stm32f1 серия имеет очень глючный I2C и даже HAL, который, вероятно, должен учитывать все ситуации, ложится на симуляции в Proteus с аналогичной картиной.
![Proteus](https://github.com/DenisOffor/Comitas_hackathon/blob/1af7cfe087933bbe971600f7b31cfd44f52a79b2/img/I2C_error_proteus_How.jpg)

## ссылки
Честно, не знаю, как ещё показать, да и нужно ли это был вообще...
[Демонстрация работы датчик на железе](https://youtu.be/nOcHCsU3fNc?si=j1XI6bf5ACNIw9PG)